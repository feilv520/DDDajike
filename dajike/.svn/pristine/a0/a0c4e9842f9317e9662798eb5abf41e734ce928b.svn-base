//
//  DClassificationViewController.m
//  dajike
//
//  Created by apple on 15/7/8.
//  Copyright (c) 2015年 haixia. All rights reserved.
//

/*

    分类模块  --  首页
 
 */

#import "DClassificationViewController.h"
#import "DClassTableViewCell.h"
#import "dDefine.h"
#import "DClassDetailTableViewCell.h"
#import "DGeneralHongBaoViewController.h"
#import "GeneralHongBaoViewController.h"
#import "DGoodsListViewController.h"
#import "DJiFenViewController.h"

@interface DClassificationViewController () <UITableViewDataSource, UITableViewDelegate>

@property (nonatomic, strong) UITableView *classTableView;

@property (nonatomic, strong) UITableView *detailTableView;

@property (nonatomic, strong) NSDictionary *dictionary;

@property (nonatomic, strong) DImgButton *searchButton;

@property (nonatomic, strong) UIView *secondView;

@property (nonatomic, strong) UIView *thirdView;

@property (nonatomic, strong) NSArray *array;

@property (nonatomic, strong) NSMutableArray *mArray;

@property (nonatomic, strong) UIImageView *leftAngle;

@property (nonatomic, strong) UIImageView *secoundLeftAngle;

@end

@implementation DClassificationViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self setNaviBarTitle:@"分类"];
    
    
    self.dictionary = @{@"photo":@[@"img_fenlei_01.png",
                                   @"img_fenlei_02.png",
                                   @"img_fenlei_03.png",
                                   @"img_fenlei_04.png",
                                   @"img_fenlei_05.png",
                                   @"img_fenlei_06.png",
                                   @"img_fenlei_07.png",
                                   @"img_fenlei_08.png"],
                        @"name":@[@"手机数码",
                                  @"美妆饰品",
                                  @"母婴玩具",
                                  @"汇吃美食",
                                  @"家具建材",
                                  @"服饰鞋帽",
                                  @"安居百货",
                                  @"家用电器"],
                        @"detail":@[@"手机,摄影摄像,数码配件",
                                    @"时尚饰品,美容护肤,眼镜",
                                    @"童装,婴幼食品,婴幼用品",
                                    @"零食坚果,粮油调味,饮料冲调",
                                    @"内衣家具,男装,时尚女鞋",
                                    @"居家布艺,住宅家具,家装主材",
                                    @"厨房用具,清洁用具,清洁工具",
                                    @"大家电,生活电器,厨房电器"]
    };
    
    self.array = @[@[@"手机",@"摄影摄像",@"数码配件",@"电脑整机",@"电脑配件"],@[@"时尚饰品",@"美容护肤",@"眼镜"],@[@"童装",@"婴幼食品",@"婴幼用品"],@[@"零食坚果",@"粮油调味",@"饮料冲调"],@[@"内衣家具",@"男装",@"时尚女鞋"],@[@"居家布艺",@"住宅家具",@"家装主材"],@[@"厨房用具",@"清洁用具",@"清洁工具"],@[@"大家电",@"生活电器",@"厨房电器"]];
    
    self.searchButton = [DBaseNavView createNavBtnWithImgNormal:@"img_pub_01" imgHighlight:@"img_pub_01" imgSelected:@"img_pub_01" target:self action:@selector(navRightButtonTapped:)];
    
    [self setNaviBarRightBtn:self.searchButton];
    
    [self addTableView:NO];
    self.dMainTableView.dataSource = self;
    self.dMainTableView.delegate = self;
    [self.dMainTableView setFrame:DRect(0, 44, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT-44-50)];
    
//    self.dMainTableView.tableFooterView = [UIView new];
    
    [self.dMainTableView registerNib:[UINib nibWithNibName:@"DClassTableViewCell" bundle:nil] forCellReuseIdentifier:@"reuse"];
    
//    [self.view addSubview:self.dMainTableView];

    self.secondView = [[UIView alloc] initWithFrame:CGRectMake(DWIDTH_CONTROLLER_DEFAULT + 5, 0, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT - 44)];
    
    self.secondView.backgroundColor = [UIColor lightGrayColor];
    
    self.secondView.layer.shadowColor=[UIColor blackColor].CGColor;
    self.secondView.layer.shadowOffset=CGSizeMake(-1, 10);
    self.secondView.layer.shadowOpacity=0.5;
    self.secondView.layer.shadowRadius=5;
    
    self.leftAngle = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"iconfont-zuoshixinjiantou"] highlightedImage:[UIImage imageNamed:@"iconfont-zuoshixinjiantou"]];
    self.leftAngle.frame = CGRectMake(-20, 76, 32, 32);
    self.leftAngle.hidden = YES;
    
    self.leftAngle.layer.shadowColor=[UIColor blackColor].CGColor;
    self.leftAngle.layer.shadowOffset=CGSizeMake(-1, -1);
    self.leftAngle.layer.shadowOpacity=0.5;
    self.leftAngle.layer.shadowRadius=5;
    
    [self.secondView addSubview:self.leftAngle];
    
    self.classTableView = [[UITableView alloc] initWithFrame:CGRectMake(1, 64, self.secondView.frame.size.width - 90, self.secondView.frame.size.height) style:UITableViewStylePlain];
    
    self.classTableView.delegate = self;
    self.classTableView.dataSource = self;
    
    [self.classTableView registerNib:[UINib nibWithNibName:@"DClassDetailTableViewCell" bundle:nil] forCellReuseIdentifier:@"class"];
    
    [self.secondView addSubview:self.classTableView];
    
    [self.view addSubview:self.secondView];
    
    self.thirdView = [[UIView alloc] initWithFrame:CGRectMake(DWIDTH_CONTROLLER_DEFAULT + 5, 0, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT - 44)];
    
    self.thirdView.backgroundColor = [UIColor lightGrayColor];
    
    self.thirdView.layer.shadowColor=[UIColor blackColor].CGColor;
    self.thirdView.layer.shadowOffset=CGSizeMake(-1, 10);
    self.thirdView.layer.shadowOpacity=0.5;
    self.thirdView.layer.shadowRadius=5;
    
    self.secoundLeftAngle = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"iconfont-zuojiantou"] highlightedImage:[UIImage imageNamed:@"iconfont-zuojiantou"]];
    self.secoundLeftAngle.frame = CGRectMake(-20, 76, 32, 32);
    self.secoundLeftAngle.hidden = YES;
    
    self.secoundLeftAngle.layer.shadowColor=[UIColor blackColor].CGColor;
    self.secoundLeftAngle.layer.shadowOffset=CGSizeMake(-1, -1);
    self.secoundLeftAngle.layer.shadowOpacity=0.5;
    self.secoundLeftAngle.layer.shadowRadius=5;

    [self.thirdView addSubview:self.secoundLeftAngle];
    
    self.detailTableView = [[UITableView alloc] initWithFrame:CGRectMake(1, 64, self.thirdView.frame.size.width - 160, self.thirdView.frame.size.height) style:UITableViewStylePlain];
    
    self.detailTableView.backgroundColor = [UIColor colorWithRed:244 / 255.0 green:244 / 255.0 blue:244 / 255.0 alpha:1.0f];
    
    self.detailTableView.delegate = self;
    self.detailTableView.dataSource = self;
    
    [self.detailTableView registerNib:[UINib nibWithNibName:@"DClassDetailTableViewCell" bundle:nil] forCellReuseIdentifier:@"class"];
    
    [self.thirdView addSubview:self.detailTableView];
    
    [self.view addSubview:self.thirdView];
    
    [self bringNaviBarToTopmost];
}

#pragma tableView delegate function
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    return 1;
}
- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 0.5f;
}
- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section
{
    return 0.5f;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    if (tableView == self.dMainTableView) {
        
        DClassTableViewCell *cell  = [tableView dequeueReusableCellWithIdentifier:@"reuse"];
        
        cell.nameLabel.text = [[self.dictionary objectForKey:@"name"] objectAtIndex:indexPath.row];
        cell.detailLabel.text = [[self.dictionary objectForKey:@"detail"] objectAtIndex:indexPath.row];
        [cell.photoImageView setImage:[UIImage imageNamed:[[self.dictionary objectForKey:@"photo"] objectAtIndex:indexPath.row]]];
        
        return cell;
        
    } else if(tableView == self.classTableView){
        DClassDetailTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"class"];
        
        cell.contentView.backgroundColor = [UIColor whiteColor];
        cell.classLabel.text = [self.mArray objectAtIndex:indexPath.row];
        
        return cell;
    } else {
        DClassDetailTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"class"];
        
        cell.classLabel.text = [self.mArray objectAtIndex:indexPath.row];
        
        return cell;
    }
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    if (tableView == self.dMainTableView)
        return 8;
    else if (tableView == self.classTableView)
        return self.mArray.count;
    else
        return self.mArray.count;
    return 0;
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{
    [tableView deselectRowAtIndexPath:indexPath animated:NO];
    if (tableView == self.dMainTableView){
        [UIView animateWithDuration:1.0f animations:^{
            self.secondView.frame = CGRectMake(90, 0, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT - 44);
            self.classTableView.frame = CGRectMake(1, 64, DWIDTH_CONTROLLER_DEFAULT - 90, DHEIGHT_CONTROLLER_DEFAULT-44);
            self.thirdView.frame = CGRectMake(DWIDTH_CONTROLLER_DEFAULT, 0, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT-44);
            self.mArray = [self.array objectAtIndex:indexPath.row];
            self.secoundLeftAngle.hidden = YES;
            [self.classTableView reloadData];
        } completion:^(BOOL finished) {
            self.leftAngle.hidden = NO;
            self.leftAngle.frame = CGRectMake(-20, 76 + 58 * indexPath.row, 32, 32);
        }];
    } else if (tableView == self.classTableView){
        [UIView animateWithDuration:1.0f animations:^{
            self.secondView.frame = CGRectMake(90, 0, 70, DHEIGHT_CONTROLLER_DEFAULT - 44);
            self.classTableView.frame = CGRectMake(1, 64, 100, self.secondView.frame.size.height);
            self.thirdView.frame = CGRectMake(160, 0, DWIDTH_CONTROLLER_DEFAULT, DHEIGHT_CONTROLLER_DEFAULT - 44);
            self.mArray = [self.array objectAtIndex:indexPath.row];
            [self.detailTableView reloadData];
        } completion:^(BOOL finished) {
            self.secoundLeftAngle.hidden = NO;
            self.secoundLeftAngle.frame = CGRectMake(-20, 76 + 58 * indexPath.row, 32, 32);
        }];
    }
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    return 58;
}

- (void)navRightButtonTapped:(id) sender
{
    //红包
//    DGeneralHongBaoViewController *dgHBVC = [[DGeneralHongBaoViewController alloc] init];
//    [self.navigationController pushViewController:dgHBVC animated:YES];
    //商品列表
//    DGoodsListViewController *goodsListVC = [[DGoodsListViewController alloc] init];
//    [self.navigationController pushViewController:goodsListVC animated:YES];
    //积分商城
    DJiFenViewController *jifenVC = [[DJiFenViewController alloc] init];
    [self.navigationController pushViewController:jifenVC animated:YES];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
